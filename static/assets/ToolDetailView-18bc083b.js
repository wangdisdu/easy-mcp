import{_ as Ve,u as Oe,v as De,x as te,r as u,o as Be,b as v,c as o,d as p,w as s,h as e,t as a,g as m,l as _,e as i,f,E as Ee,k as r,F as $,y as V,p as Re,m as Le,q as se}from"./index-c5623d35.js";import{c as g,A as Ne,f as H,S as Ie,F as Pe}from"./AppLayout-91e68111.js";/* empty css                                                     */import{R as oe}from"./RollbackOutlined-2ba83c72.js";import{B as qe,P as Fe}from"./PauseCircleOutlined-01fd97b2.js";import{P as Ue}from"./PlayCircleOutlined-ed5d721f.js";const d=O=>(Re("data-v-7471f6d6"),O=O(),Le(),O),Ke={class:"info-container"},ze={class:"info-row"},He=d(()=>e("div",{class:"info-label"},"工具名称:",-1)),Ae={class:"info-value"},je={class:"info-row"},Je=d(()=>e("div",{class:"info-label"},"工具描述:",-1)),Qe={class:"info-value"},Ge={class:"info-row"},We=d(()=>e("div",{class:"info-label"},"工具类型:",-1)),Xe={class:"info-value"},Ye={class:"info-row"},Ze=d(()=>e("div",{class:"info-label"},"状态:",-1)),et={class:"info-value"},tt={class:"info-row"},st=d(()=>e("div",{class:"info-label"},"当前版本:",-1)),ot={class:"info-value"},at={class:"info-row"},lt=d(()=>e("div",{class:"info-label"},"创建时间:",-1)),nt={class:"info-value"},it={class:"info-row"},ct=d(()=>e("div",{class:"info-label"},"更新时间:",-1)),rt={class:"info-value"},dt={class:"info-row"},ut=d(()=>e("div",{class:"info-label"},"创建人:",-1)),_t={class:"info-value"},vt={class:"info-row"},pt=d(()=>e("div",{class:"info-label"},"更新人:",-1)),ft={class:"info-value"},mt={class:"info-row"},ht=d(()=>e("div",{class:"info-label"},"请求地址:",-1)),yt={class:"info-value"},gt={class:"info-row"},bt=d(()=>e("div",{class:"info-label"},"请求方法:",-1)),kt={class:"info-value"},wt={key:0,class:"info-row"},$t=d(()=>e("div",{class:"info-label"},"请求头:",-1)),Ct={class:"info-value"},xt={key:0},St={class:"info-row"},Tt=d(()=>e("div",{class:"info-label"},"DB URL:",-1)),Mt={class:"info-value"},Vt={class:"info-row"},Ot=d(()=>e("div",{class:"info-label"},"查询SQL:",-1)),Dt={class:"info-value"},Bt={class:"sql-display"},Et={key:1,class:"parameters-container"},Rt={class:"parameter-header"},Lt={class:"parameter-name"},Nt={key:0,class:"parameter-description"},It={key:1,class:"parameter-details"},Pt={key:0,class:"parameter-enum"},qt=d(()=>e("span",{class:"parameter-detail-label"},"可选值:",-1)),Ft={class:"parameter-enum-values"},Ut={key:1,class:"parameter-format"},Kt=d(()=>e("span",{class:"parameter-detail-label"},"格式:",-1)),zt={class:"parameter-detail-value"},Ht={key:2,class:"parameter-items"},At=d(()=>e("span",{class:"parameter-detail-label"},"元素类型:",-1)),jt={class:"parameter-detail-value"},Jt={key:3,class:"parameter-default"},Qt=d(()=>e("span",{class:"parameter-detail-label"},"默认值:",-1)),Gt={class:"parameter-detail-value"},Wt={key:4,class:"parameter-min"},Xt=d(()=>e("span",{class:"parameter-detail-label"},"最小值:",-1)),Yt={class:"parameter-detail-value"},Zt={key:5,class:"parameter-max"},es=d(()=>e("span",{class:"parameter-detail-label"},"最大值:",-1)),ts={class:"parameter-detail-value"},ss={key:6,class:"parameter-min-length"},os=d(()=>e("span",{class:"parameter-detail-label"},"最小长度:",-1)),as={class:"parameter-detail-value"},ls={key:7,class:"parameter-max-length"},ns=d(()=>e("span",{class:"parameter-detail-label"},"最大长度:",-1)),is={class:"parameter-detail-value"},cs={class:"code-container"},rs={class:"code-display"},ds={key:1,class:"version-list"},us={class:"version-row"},_s=d(()=>e("div",{class:"version-label"},"版本:",-1)),vs=d(()=>e("div",{class:"version-label time-label"},"发布时间:",-1)),ps={class:"version-time"},fs={key:0,class:"version-description"},ms={class:"code-display"},hs={class:"rollback-warning"},ys={class:"rollback-code-container"},gs={class:"rollback-code-header"},bs={class:"code-display"},ks=["onClick"],ws={class:"config-description"},$s=["onClick"],Cs={class:"func-description"},xs={__name:"ToolDetailView",setup(O){const T=Oe(),ae=De(),h=te(()=>ae.params.id),A=u(!1),c=u(null),N=u([]),j=u(!1),le=u(1),ne=u(10),ie=u(0),J=u("basic"),I=u([]),P=u([]),D=u(!1),M=u(!1),k=u(null),C=u(""),ce=u(null),q=u(!1),F=u(!1),U=u(""),K=u(!1),re=[{title:"Key",dataIndex:"key",key:"key",width:"40%"},{title:"Value",dataIndex:"value",key:"value",width:"60%"}],w=te(()=>!c.value||!c.value.parameters?null:c.value.parameters),de=l=>!w.value||!w.value.required?!1:w.value.required.includes(l);Be(()=>{B(),Q(),ue(),_e()});const B=async()=>{A.value=!0;try{await g({method:"get",url:`/api/v1/tool/${h.value}`,onSuccess:l=>{c.value=l},errorMessage:"获取工具数据失败"})}finally{A.value=!1}},Q=async()=>{j.value=!0;try{await g({method:"get",url:`/api/v1/tool/${h.value}/deploy/history`,params:{page:le.value,size:ne.value},onSuccess:(l,n)=>{N.value=l,ie.value=n.total},errorMessage:"获取发布历史失败"})}finally{j.value=!1}},ue=async()=>{try{await g({method:"get",url:`/api/v1/tool/${h.value}/config`,onSuccess:l=>{I.value=l||[]},errorMessage:"获取绑定配置失败"})}catch(l){console.error("Error fetching bound configs:",l)}},_e=async()=>{try{await g({method:"get",url:`/api/v1/tool/${h.value}/func`,onSuccess:l=>{P.value=l||[]},errorMessage:"获取依赖函数失败"})}catch(l){console.error("Error fetching dependent functions:",l)}},ve=async l=>{try{if(k.value=l.version,l.code){C.value=l.code,D.value=!0;return}await g({method:"get",url:`/api/v1/tool/${h.value}/version/${l.version}`,onSuccess:n=>{C.value=n.code||"// No code available for this version",D.value=!0},errorMessage:"获取工具代码失败"})}catch(n){console.error("Error fetching version code:",n),se.error("获取工具代码失败")}},pe=async l=>{try{if(k.value=l.version,ce.value=l,l.code){C.value=l.code,M.value=!0;return}await g({method:"get",url:`/api/v1/tool/${h.value}/version/${l.version}`,onSuccess:n=>{C.value=n.code||"// No code available for this version",M.value=!0},errorMessage:"获取工具代码失败"})}catch(n){console.error("Error fetching version code:",n),se.error("获取工具代码失败")}},fe=async()=>{if(k.value){q.value=!0;try{await g({method:"post",url:`/api/v1/tool/${h.value}/deploy/rollback/${k.value}`,successMessage:"回滚成功",errorMessage:"回滚失败",onSuccess:()=>{B(),M.value=!1}})}catch(l){console.error("Error rolling back tool:",l)}finally{q.value=!1}}},me=async()=>{K.value=!0;try{await g({method:"post",url:`/api/v1/tool/${h.value}/deploy`,data:{description:U.value},successMessage:"发布成功",errorMessage:"发布失败",onSuccess:()=>{F.value=!1,B(),Q()}})}finally{K.value=!1}},G=async l=>{try{const n=l?"enable":"disable";await g({method:"patch",url:`/api/v1/tool/${h.value}/${n}`,successMessage:`${l?"启用":"禁用"}成功`,errorMessage:`${l?"启用":"禁用"}失败`,onSuccess:()=>{B()}})}catch(n){console.error(`Error ${l?"enabling":"disabling"} tool:`,n)}},he=l=>{switch(l){case"http":return"blue";case"database":return"purple";default:return"green"}},ye=l=>{switch(l){case"http":return"HTTP工具";case"database":return"数据库工具";default:return"基础工具"}};return(l,n)=>{const b=v("a-tag"),x=v("a-button"),ge=v("a-space"),be=v("a-table"),S=v("a-tab-pane"),E=v("a-empty"),z=v("a-modal"),ke=v("a-alert"),W=v("a-list-item-meta"),X=v("a-list-item"),Y=v("a-list"),we=v("a-tabs"),$e=v("a-card"),Ce=v("a-textarea"),xe=v("a-form-item"),Se=v("a-form");return o(),p(Ne,{"current-page-key":"tool"},{default:s(()=>[c.value?(o(),p($e,{key:0},{title:s(()=>[e("span",null,"工具详情 - "+a(c.value.name),1),c.value.current_version?(o(),p(b,{key:0,color:"blue",class:"version-tag"},{default:s(()=>[m("v"+a(c.value.current_version),1)]),_:1})):_("",!0)]),extra:s(()=>[i(ge,null,{default:s(()=>[i(x,{onClick:n[0]||(n[0]=t=>f(T).push("/tool"))},{icon:s(()=>[i(f(oe))]),default:s(()=>[m(" 返回 ")]),_:1}),i(x,{type:"primary",onClick:n[1]||(n[1]=t=>f(T).push(`/tool/${h.value}/edit`))},{icon:s(()=>[i(f(Ee))]),default:s(()=>[m(" 编辑 ")]),_:1}),i(x,{type:"primary",onClick:n[2]||(n[2]=t=>f(T).push(`/tool/${h.value}/debug`))},{icon:s(()=>[i(f(qe))]),default:s(()=>[m(" 调试 ")]),_:1}),c.value.is_enabled?(o(),p(x,{key:0,type:"primary",danger:"",onClick:n[3]||(n[3]=t=>G(!1))},{icon:s(()=>[i(f(Fe))]),default:s(()=>[m(" 禁用 ")]),_:1})):(o(),p(x,{key:1,type:"primary",onClick:n[4]||(n[4]=t=>G(!0))},{icon:s(()=>[i(f(Ue))]),default:s(()=>[m(" 启用 ")]),_:1}))]),_:1})]),default:s(()=>[i(we,{activeKey:J.value,"onUpdate:activeKey":n[7]||(n[7]=t=>J.value=t)},{default:s(()=>[i(S,{key:"basic",tab:"基本信息"},{default:s(()=>{var t,y,R,L,Z,ee;return[e("div",Ke,[e("div",ze,[He,e("div",Ae,a(c.value.name),1)]),e("div",je,[Je,e("div",Qe,a(c.value.description||"无描述"),1)]),e("div",Ge,[We,e("div",Xe,[i(b,{color:he(c.value.type)},{default:s(()=>[m(a(ye(c.value.type)),1)]),_:1},8,["color"])])]),e("div",Ye,[Ze,e("div",et,[i(b,{color:c.value.is_enabled?"green":"red"},{default:s(()=>[m(a(c.value.is_enabled?"已启用":"已禁用"),1)]),_:1},8,["color"])])]),e("div",tt,[st,e("div",ot,a(c.value.current_version||"未发布"),1)]),e("div",at,[lt,e("div",nt,a(f(H)(c.value.created_at)),1)]),e("div",it,[ct,e("div",rt,a(f(H)(c.value.updated_at)),1)]),e("div",dt,[ut,e("div",_t,a(c.value.created_by||"-"),1)]),e("div",vt,[pt,e("div",ft,a(c.value.updated_by||"-"),1)]),c.value.type==="http"?(o(),r($,{key:0},[e("div",mt,[ht,e("div",yt,a(((t=c.value.setting)==null?void 0:t.url)||"-"),1)]),e("div",gt,[bt,e("div",kt,a(((y=c.value.setting)==null?void 0:y.method)||"-"),1)]),(L=(R=c.value.setting)==null?void 0:R.headers)!=null&&L.length?(o(),r("div",wt,[$t,e("div",Ct,[i(be,{columns:re,"data-source":c.value.setting.headers,pagination:!1,size:"small",bordered:""},{bodyCell:s(({column:Te,record:Me})=>[Te.key==="value"?(o(),r("span",xt,a(Me.value),1)):_("",!0)]),_:1},8,["data-source"])])])):_("",!0)],64)):_("",!0),c.value.type==="database"?(o(),r($,{key:1},[e("div",St,[Tt,e("div",Mt,a(((Z=c.value.setting)==null?void 0:Z.url)||"-"),1)]),e("div",Vt,[Ot,e("div",Dt,[e("pre",Bt,a(((ee=c.value.setting)==null?void 0:ee.sql)||"-"),1)])])],64)):_("",!0)])]}),_:1}),i(S,{key:"parameters",tab:"参数定义"},{default:s(()=>[!w.value||!w.value.properties||Object.keys(w.value.properties).length===0?(o(),p(E,{key:0,description:"无参数定义"})):(o(),r("div",Et,[(o(!0),r($,null,V(w.value.properties,(t,y)=>(o(),r("div",{key:y,class:"parameter-item"},[e("div",Rt,[e("span",Lt,a(t.title||y),1),i(b,{class:"parameter-type"},{default:s(()=>[m(a(t.type||"string"),1)]),_:2},1024),t.location?(o(),p(b,{key:0,color:"purple"},{default:s(()=>[m(a(t.location),1)]),_:2},1024)):_("",!0),de(y)?(o(),p(b,{key:1,color:"red"},{default:s(()=>[m("必填")]),_:1})):_("",!0)]),t.description?(o(),r("div",Nt,a(t.description),1)):_("",!0),t.enum||t.default!==void 0||t.minimum!==void 0||t.maximum!==void 0||t.format||t.items&&t.items.type?(o(),r("div",It,[t.enum?(o(),r("div",Pt,[qt,e("div",Ft,[(o(!0),r($,null,V(t.enum,(R,L)=>(o(),p(b,{key:L,color:"blue"},{default:s(()=>[m(a(R),1)]),_:2},1024))),128))])])):_("",!0),t.format?(o(),r("div",Ut,[Kt,e("span",zt,a(t.format),1)])):_("",!0),t.items&&t.items.type?(o(),r("div",Ht,[At,e("span",jt,a(t.items.type),1)])):_("",!0),t.default!==void 0?(o(),r("div",Jt,[Qt,e("span",Gt,a(JSON.stringify(t.default)),1)])):_("",!0),t.minimum!==void 0?(o(),r("div",Wt,[Xt,e("span",Yt,a(t.minimum),1)])):_("",!0),t.maximum!==void 0?(o(),r("div",Zt,[es,e("span",ts,a(t.maximum),1)])):_("",!0),t.minLength!==void 0?(o(),r("div",ss,[os,e("span",as,a(t.minLength),1)])):_("",!0),t.maxLength!==void 0?(o(),r("div",ls,[ns,e("span",is,a(t.maxLength),1)])):_("",!0)])):_("",!0)]))),128))]))]),_:1}),i(S,{key:"code",tab:"工具代码"},{default:s(()=>[e("div",cs,[e("pre",rs,a(c.value.code),1)])]),_:1}),i(S,{key:"history",tab:"发布历史"},{default:s(()=>[N.value.length?(o(),r("div",ds,[(o(!0),r($,null,V(N.value,t=>(o(),r("div",{key:t.id,class:"version-item"},[e("div",us,[_s,i(b,{class:"version-tag",color:c.value.current_version===t.version?"blue":"default",onClick:y=>ve(t)},{default:s(()=>[m(" v"+a(t.version),1)]),_:2},1032,["color","onClick"]),vs,e("span",ps,a(f(H)(t.created_at)),1),i(x,{type:"primary",size:"small",disabled:c.value.current_version===t.version,class:"rollback-button",onClick:y=>pe(t)},{icon:s(()=>[i(f(oe))]),default:s(()=>[m(" 回滚 ")]),_:2},1032,["disabled","onClick"])]),t.description?(o(),r("div",fs,a(t.description),1)):_("",!0)]))),128))])):(o(),p(E,{key:0,description:"无发布历史"})),i(z,{open:D.value,"onUpdate:open":n[5]||(n[5]=t=>D.value=t),title:`工具代码 (v${k.value})`,width:"800px",footer:null},{default:s(()=>[e("pre",ms,a(C.value),1)]),_:1},8,["open","title"]),i(z,{open:M.value,"onUpdate:open":n[6]||(n[6]=t=>M.value=t),title:`确认回滚到版本 v${k.value}?`,width:"800px","confirm-loading":q.value,"ok-text":"确认回滚","cancel-text":"取消",onOk:fe},{default:s(()=>[e("div",hs,[i(ke,{message:"警告",description:"回滚操作将使当前工具代码替换为选中版本的代码，请确认该操作。",type:"warning","show-icon":"",style:{"margin-bottom":"16px"}})]),e("div",ys,[e("div",gs,"版本 v"+a(k.value)+" 的代码:",1),e("pre",bs,a(C.value),1)])]),_:1},8,["open","title","confirm-loading"])]),_:1}),i(S,{key:"configs",tab:"绑定配置"},{default:s(()=>[I.value.length?(o(),p(Y,{key:1},{default:s(()=>[(o(!0),r($,null,V(I.value,t=>(o(),p(X,{key:t.id},{default:s(()=>[i(W,null,{avatar:s(()=>[i(f(Ie),{class:"config-icon"})]),title:s(()=>[e("a",{class:"config-link",onClick:y=>f(T).push(`/config/${t.id}`)},a(t.name),9,ks)]),description:s(()=>[e("div",ws,a(t.description||"无描述"),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(o(),p(E,{key:0,description:"无绑定配置"}))]),_:1}),i(S,{key:"funcs",tab:"依赖函数"},{default:s(()=>[P.value.length?(o(),p(Y,{key:1},{default:s(()=>[(o(!0),r($,null,V(P.value,t=>(o(),p(X,{key:t.id},{default:s(()=>[i(W,null,{avatar:s(()=>[i(f(Pe),{class:"func-icon"})]),title:s(()=>[e("a",{class:"func-link",onClick:y=>f(T).push(`/func/${t.id}`)},a(t.name),9,$s)]),description:s(()=>[e("div",Cs,a(t.description||"无描述"),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(o(),p(E,{key:0,description:"无依赖函数"}))]),_:1})]),_:1},8,["activeKey"])]),_:1})):_("",!0),i(z,{open:F.value,"onUpdate:open":n[9]||(n[9]=t=>F.value=t),title:"发布工具","confirm-loading":K.value,"ok-text":"确定","cancel-text":"取消",onOk:me},{default:s(()=>[i(Se,{layout:"vertical"},{default:s(()=>[i(xe,{label:"发布描述"},{default:s(()=>[i(Ce,{value:U.value,"onUpdate:value":n[8]||(n[8]=t=>U.value=t),rows:4,placeholder:"请输入发布描述"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open","confirm-loading"])]),_:1})}}},Bs=Ve(xs,[["__scopeId","data-v-7471f6d6"]]);export{Bs as default};
