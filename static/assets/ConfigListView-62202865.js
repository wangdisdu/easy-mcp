import{r as _,q as W,v as T,o as I,b as r,c as u,j as g,e as l,w as n,F as V,s as k,d as v,g as y,t as F,_ as X,u as Z,h as ee,f as h,P as ae,E as te,l as ne,D as le,k as A}from"./index-53057e88.js";import{c as B,A as oe,f as se,S as ue}from"./AppLayout-7b7aaf0d.js";const ce={class:"json-schema-form"},re={__name:"JsonSchemaForm",props:{schema:{type:Object,required:!0},value:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["update:value","submit","cancel"],setup(j,{emit:b}){const i=j,s=_({}),M=W(()=>{const c={};return i.schema&&i.schema.properties&&Object.keys(i.schema.properties).forEach(o=>{const p=i.schema.properties[o];c[o]={...p,required:i.schema.required&&i.schema.required.includes(o)}}),c}),f=()=>{const c={...i.value};i.schema&&i.schema.properties&&Object.keys(i.schema.properties).forEach(o=>{const p=i.schema.properties[o];c[o]===void 0&&p.default!==void 0&&(c[o]=p.default),c[o]===void 0&&(p.type==="string"?c[o]="":p.type==="number"||p.type==="integer"?c[o]=null:p.type==="boolean"?c[o]=!1:p.type==="array"?c[o]=[]:p.type==="object"&&(c[o]={}))}),s.value=c},$=()=>{b("update:value",s.value),b("submit",s.value)},x=()=>{b("cancel")};return T(()=>i.value,()=>{f()},{deep:!0}),T(()=>i.schema,()=>{f()},{deep:!0}),I(()=>{f()}),(c,o)=>{const p=r("a-input"),d=r("a-form-item"),E=r("a-input-number"),C=r("a-select-option"),Y=r("a-select"),N=r("a-switch"),z=r("a-date-picker"),L=r("a-textarea"),O=r("a-button"),q=r("a-form");return u(),g("div",ce,[l(q,{model:s.value,"label-col":{span:6},"wrapper-col":{span:18},onFinish:$},{default:n(()=>[(u(!0),g(V,null,k(M.value,(a,e)=>(u(),g(V,{key:e},[a.type==="string"&&!a.enum&&!a.format?(u(),v(d,{key:0,label:a.title||e,name:e,rules:[{required:a.required,message:`请输入${a.title||e}`}],help:a.description},{default:n(()=>[l(p,{value:s.value[e],"onUpdate:value":t=>s.value[e]=t,placeholder:a.placeholder||`请输入${a.title||e}`},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["label","name","rules","help"])):a.type==="number"||a.type==="integer"?(u(),v(d,{key:1,label:a.title||e,name:e,rules:[{required:a.required,message:`请输入${a.title||e}`}],help:a.description},{default:n(()=>[l(E,{value:s.value[e],"onUpdate:value":t=>s.value[e]=t,min:a.minimum,max:a.maximum,step:a.type==="integer"?1:.1,style:{width:"100%"}},null,8,["value","onUpdate:value","min","max","step"])]),_:2},1032,["label","name","rules","help"])):a.enum?(u(),v(d,{key:2,label:a.title||e,name:e,rules:[{required:a.required,message:`请选择${a.title||e}`}],help:a.description},{default:n(()=>[l(Y,{value:s.value[e],"onUpdate:value":t=>s.value[e]=t,placeholder:`请选择${a.title||e}`,style:{width:"100%"}},{default:n(()=>[(u(!0),g(V,null,k(a.enum,(t,U)=>(u(),v(C,{key:U,value:t},{default:n(()=>[y(F(a.enumNames&&a.enumNames[U]?a.enumNames[U]:t),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])]),_:2},1032,["label","name","rules","help"])):a.type==="boolean"?(u(),v(d,{key:3,label:a.title||e,name:e,help:a.description},{default:n(()=>[l(N,{checked:s.value[e],"onUpdate:checked":t=>s.value[e]=t},null,8,["checked","onUpdate:checked"])]),_:2},1032,["label","name","help"])):a.format==="date"?(u(),v(d,{key:4,label:a.title||e,name:e,rules:[{required:a.required,message:`请选择${a.title||e}`}],help:a.description},{default:n(()=>[l(z,{value:s.value[e],"onUpdate:value":t=>s.value[e]=t,style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name","rules","help"])):a.format==="date-time"?(u(),v(d,{key:5,label:a.title||e,name:e,rules:[{required:a.required,message:`请选择${a.title||e}`}],help:a.description},{default:n(()=>[l(z,{value:s.value[e],"onUpdate:value":t=>s.value[e]=t,"show-time":"",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name","rules","help"])):a.format==="textarea"?(u(),v(d,{key:6,label:a.title||e,name:e,rules:[{required:a.required,message:`请输入${a.title||e}`}],help:a.description},{default:n(()=>[l(L,{value:s.value[e],"onUpdate:value":t=>s.value[e]=t,placeholder:a.placeholder||`请输入${a.title||e}`,rows:4},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["label","name","rules","help"])):(u(),v(d,{key:7,label:a.title||e,name:e,rules:[{required:a.required,message:`请输入${a.title||e}`}],help:a.description},{default:n(()=>[l(p,{value:s.value[e],"onUpdate:value":t=>s.value[e]=t,placeholder:a.placeholder||`请输入${a.title||e}`},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["label","name","rules","help"]))],64))),128)),l(d,{"wrapper-col":{span:18,offset:6}},{default:n(()=>[l(O,{type:"primary","html-type":"submit",loading:j.loading},{default:n(()=>[y("保存")]),_:1},8,["loading"]),l(O,{style:{"margin-left":"10px"},onClick:x},{default:n(()=>[y("取消")]),_:1})]),_:1})]),_:1},8,["model"])])}}};const ie={class:"action-bar"},pe=["onClick"],me={key:1},de={key:2},_e={key:0,class:"empty-schema"},ve={key:1},he={__name:"ConfigListView",setup(j){const b=Z(),i=_(!1),s=_([]),M=_(0),f=_(1),$=_(10),x=_(""),c=_(!1),o=_(null),p=_(!1),d=_({}),E=[{title:"名称",dataIndex:"name",key:"name",width:160,ellipsis:!0,tooltip:!0},{title:"描述",dataIndex:"description",key:"description",width:200,ellipsis:!0,tooltip:!0},{title:"创建时间",key:"created_at",width:160},{title:"操作",key:"action",width:200,fixed:"right"}];I(()=>{C()});const C=async()=>{i.value=!0;try{await B({method:"get",url:"/api/v1/config",params:{page:f.value,size:$.value,search:x.value||void 0},onSuccess:(e,t)=>{s.value=e,M.value=t.total},errorMessage:"获取配置列表失败"})}finally{i.value=!1}},Y=()=>{f.value=1,C()},N=(e,t)=>{f.value=e,$.value=t,C()},z=(e,t)=>{f.value=1,$.value=t,C()},L=async e=>{try{await B({method:"delete",url:`/api/v1/config/${e}`,successMessage:"删除成功",errorMessage:"删除失败"}),C()}catch(t){console.error("Error deleting config:",t)}},O=e=>{o.value=e,d.value=e.conf_value||{},c.value=!0},q=()=>{c.value=!1,o.value=null,d.value={}},a=async e=>{if(o.value){p.value=!0;try{await B({method:"patch",url:`/api/v1/config/${o.value.id}`,data:{name:o.value.name,description:o.value.description,conf_schema:o.value.conf_schema,conf_value:e},successMessage:"配置保存成功",errorMessage:"配置保存失败"}),C(),q()}catch(t){console.error("Error saving config value:",t)}finally{p.value=!1}}};return(e,t)=>{const U=r("a-input-search"),S=r("a-button"),H=r("a-popconfirm"),J=r("a-space"),R=r("a-table"),G=r("a-empty"),K=r("a-modal"),Q=r("a-card");return u(),v(oe,{"current-page-key":"config"},{default:n(()=>[l(Q,{title:"配置管理"},{default:n(()=>{var P;return[ee("div",ie,[l(U,{value:x.value,"onUpdate:value":t[0]||(t[0]=m=>x.value=m),placeholder:"搜索配置名称或描述",style:{width:"300px"},onSearch:Y},null,8,["value"]),l(S,{type:"primary",onClick:t[1]||(t[1]=m=>h(b).push("/config/create"))},{icon:n(()=>[l(h(ae))]),default:n(()=>[y(" 创建配置 ")]),_:1})]),l(R,{columns:E,"data-source":s.value,loading:i.value,pagination:{current:f.value,pageSize:$.value,total:M.value,onChange:N,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onShowSizeChange:z,showTotal:m=>`共 ${m} 条记录`},"row-key":m=>m.id},{bodyCell:n(({column:m,record:w})=>[m.key==="name"?(u(),g("a",{key:0,onClick:D=>h(b).push(`/config/${w.id}`)},F(w.name),9,pe)):m.key==="description"?(u(),g("span",me,F(w.description||"无描述"),1)):m.key==="created_at"?(u(),g("span",de,F(h(se)(w.created_at)),1)):m.key==="action"?(u(),v(J,{key:3},{default:n(()=>[l(S,{type:"link",size:"small",onClick:D=>h(b).push(`/config/${w.id}`)},{icon:n(()=>[l(h(te))]),default:n(()=>[y(" 查看 ")]),_:2},1032,["onClick"]),l(S,{type:"link",size:"small",onClick:D=>h(b).push(`/config/${w.id}/edit`)},{icon:n(()=>[l(h(ne))]),default:n(()=>[y(" 编辑 ")]),_:2},1032,["onClick"]),l(S,{type:"link",size:"small",onClick:D=>O(w)},{icon:n(()=>[l(h(ue))]),default:n(()=>[y(" 配置 ")]),_:2},1032,["onClick"]),l(H,{title:"确定要删除此配置吗？","ok-text":"确定","cancel-text":"取消",onConfirm:D=>L(w.id)},{default:n(()=>[l(S,{type:"link",size:"small",danger:""},{icon:n(()=>[l(h(le))]),default:n(()=>[y(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):A("",!0)]),_:1},8,["data-source","loading","pagination","row-key"]),l(K,{open:c.value,"onUpdate:open":t[3]||(t[3]=m=>c.value=m),title:`配置设置: ${((P=o.value)==null?void 0:P.name)||""}`,width:"800px",footer:null,onCancel:q},{default:n(()=>[o.value?(u(),g(V,{key:0},[!o.value.conf_schema||Object.keys(o.value.conf_schema).length===0?(u(),g("div",_e,[l(G,{description:"没有可用的配置模式"})])):(u(),g("div",ve,[l(re,{schema:o.value.conf_schema,value:d.value,"onUpdate:value":t[2]||(t[2]=m=>d.value=m),loading:p.value,onSubmit:a,onCancel:q},null,8,["schema","value","loading"])]))],64)):A("",!0)]),_:1},8,["open","title"])]}),_:1})]),_:1})}}},be=X(he,[["__scopeId","data-v-fff57cca"]]);export{be as default};
