import{e as n,A as I,u as Q,n as F,q as _,r as h,a as G,o as W,b as i,c as C,d as V,w as r,f as g,g as y,h as f,k as X,m}from"./index-53057e88.js";import{c as O,A as Y,v as x}from"./AppLayout-7b7aaf0d.js";import{_ as M}from"./MonacoEditor-95101635.js";import{Q as Z}from"./QuestionCircleOutlined-96d10665.js";import{R as ee}from"./RollbackOutlined-c89baf36.js";import{S as te}from"./SaveOutlined-3e324e3b.js";/* empty css                                                     */var ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M848 359.3H627.7L825.8 109c4.1-5.3.4-13-6.3-13H436c-2.8 0-5.5 1.5-6.9 4L170 547.5c-3.1 5.3.7 12 6.9 12h174.4l-89.4 357.6c-1.9 7.8 7.5 13.3 13.3 7.7L853.5 373c5.2-4.9 1.7-13.7-5.5-13.7zM378.2 732.5l60.3-241H281.1l189.6-327.4h224.6L487 427.4h211L378.2 732.5z"}}]},name:"thunderbolt",theme:"outlined"};const ne=ae;function T(c){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},u=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(o).filter(function(p){return Object.getOwnPropertyDescriptor(o,p).enumerable}))),u.forEach(function(p){re(c,p,o[p])})}return c}function re(c,s,o){return s in c?Object.defineProperty(c,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):c[s]=o,c}var N=function(s,o){var u=T({},s,o.attrs);return n(I,T({},u,{icon:ne}),null)};N.displayName="ThunderboltOutlined";N.inheritAttrs=!1;const se=N,oe={class:"tab-description"},le={class:"editor-container"},ie={class:"tab-description"},ce={class:"generate-button-container"},ue={class:"editor-container"},Se={__name:"ConfigEditView",setup(c){const s=Q(),o=F(),u=_(()=>o.params.id),p=_(()=>!!u.value),S=h(!1),J=h(!1),j=h("schema"),t=G({name:"",description:"",schemaStr:JSON.stringify({type:"object",properties:{apiKey:{type:"string",description:"API密钥"},timeout:{type:"integer",description:"超时时间（秒）",default:30}},required:["apiKey"]},null,2),valuesStr:JSON.stringify({apiKey:"",timeout:30},null,2)});_(()=>{try{const e=JSON.parse(t.schemaStr);return JSON.stringify(e,null,2)}catch{return"无效的 JSON"}}),_(()=>{try{const e=JSON.parse(t.valuesStr);return JSON.stringify(e,null,2)}catch{return"无效的 JSON"}});const w=_(()=>{try{const e=JSON.parse(t.schemaStr);return e&&e.type==="object"&&e.properties&&Object.keys(e.properties).length>0}catch{return!1}}),A=()=>{try{const e=JSON.parse(t.schemaStr);if(!e||e.type!=="object"||!e.properties){m.error("配置定义不是有效的JSON Schema");return}const a={};Object.entries(e.properties).forEach(([l,v])=>{if(v.default!==void 0)a[l]=v.default;else switch(v.type){case"string":a[l]="";break;case"number":case"integer":a[l]=0;break;case"boolean":a[l]=!1;break;case"array":a[l]=[];break;case"object":a[l]={};break;default:a[l]=null}}),t.valuesStr=JSON.stringify(a,null,2),m.success("配置信息生成成功")}catch(e){m.error(`生成配置信息失败: ${e.message}`)}};W(()=>{p.value&&B()});const B=async()=>{J.value=!0;try{await O({method:"get",url:`/api/v1/config/${u.value}`,onSuccess:e=>{t.name=e.name,t.description=e.description||"",t.schemaStr=JSON.stringify(e.conf_schema,null,2),t.valuesStr=e.conf_value?JSON.stringify(e.conf_value,null,2):"{}"},errorMessage:"获取配置数据失败"})}finally{J.value=!1}},P=()=>{if(!t.name)return m.error("请输入配置名称"),!1;const e=x(t.schemaStr);if(!e.valid)return m.error("配置架构 JSON 格式不正确: "+e.message),!1;if(t.valuesStr){const a=x(t.valuesStr);if(!a.valid)return m.error("配置值 JSON 格式不正确: "+a.message),!1}return!0},$=()=>({name:t.name,description:t.description,conf_schema:JSON.parse(t.schemaStr),conf_value:t.valuesStr?JSON.parse(t.valuesStr):null}),K=async()=>{if(P()){S.value=!0;try{const e=$();p.value?await O({method:"put",url:`/api/v1/config/${u.value}`,data:e,successMessage:"保存成功",errorMessage:"保存失败",onSuccess:()=>{b()}}):await O({method:"post",url:"/api/v1/config",data:e,successMessage:"创建成功",errorMessage:"创建失败",onSuccess:()=>{b()}})}finally{S.value=!1}}},b=()=>{s.back()};return(e,a)=>{const l=i("a-button"),v=i("a-space"),U=i("a-input"),L=i("a-form-item"),z=i("a-textarea"),E=i("a-alert"),k=i("a-tab-pane"),R=i("a-tooltip"),q=i("a-tabs"),D=i("a-form"),H=i("a-card");return C(),V(Y,{"current-page-key":"config"},{default:r(()=>[n(H,{title:p.value?"编辑配置":"创建配置"},{extra:r(()=>[n(v,null,{default:r(()=>[n(l,{size:"middle",onClick:b},{icon:r(()=>[n(g(ee))]),default:r(()=>[y(" 返回 ")]),_:1}),n(l,{type:"primary",loading:S.value,size:"middle",onClick:K},{icon:r(()=>[n(g(te))]),default:r(()=>[y(" 保存 ")]),_:1},8,["loading"])]),_:1})]),default:r(()=>[n(D,{model:t,layout:"vertical",class:"form-container"},{default:r(()=>[n(L,{label:"配置名称",required:""},{default:r(()=>[n(U,{value:t.name,"onUpdate:value":a[0]||(a[0]=d=>t.name=d),placeholder:"请输入配置名称"},null,8,["value"])]),_:1}),n(L,{label:"配置描述"},{default:r(()=>[n(z,{value:t.description,"onUpdate:value":a[1]||(a[1]=d=>t.description=d),placeholder:"请输入配置描述",rows:3},null,8,["value"])]),_:1}),f("div",null,[n(q,{activeKey:j.value,"onUpdate:activeKey":a[4]||(a[4]=d=>j.value=d)},{default:r(()=>[n(k,{key:"schema",tab:"配置定义","force-render":""},{default:r(()=>[f("div",oe,[n(E,{message:"配置定义说明",description:"使用JSON Schema格式定义配置项的结构。定义每个配置项的类型和描述，系统将根据此定义生成配置表单。",type:"info","show-icon":""})]),f("div",le,[n(M,{value:t.schemaStr,"onUpdate:value":a[2]||(a[2]=d=>t.schemaStr=d),language:"json",options:{automaticLayout:!0,scrollBeyondLastLine:!1}},null,8,["value"])])]),_:1}),n(k,{key:"values",tab:"配置设置","force-render":""},{default:r(()=>[f("div",ie,[f("div",ce,[n(l,{type:"primary",disabled:!w.value,onClick:A},{icon:r(()=>[n(g(se))]),default:r(()=>[y(" 生成配置信息 ")]),_:1},8,["disabled"]),w.value?X("",!0):(C(),V(R,{key:0,title:"配置定义不是有效的JSON Schema"},{default:r(()=>[n(g(Z),{class:"tooltip-icon"})]),_:1}))])]),f("div",ue,[n(M,{value:t.valuesStr,"onUpdate:value":a[3]||(a[3]=d=>t.valuesStr=d),language:"json",options:{automaticLayout:!0,scrollBeyondLastLine:!1}},null,8,["value"])])]),_:1})]),_:1},8,["activeKey"])])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})}}};export{Se as default};
