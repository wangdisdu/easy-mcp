import{u as G,n as Q,q as y,r as i,a as X,o as Y,b as r,c as Z,d as ee,w as s,e as o,f as S,g as b,t as ae,h,m}from"./index-53057e88.js";import{c as l,A as oe,v as te}from"./AppLayout-7b7aaf0d.js";import{_ as x}from"./MonacoEditor-95101635.js";import{R as se}from"./RollbackOutlined-c89baf36.js";import{S as ne}from"./SaveOutlined-3e324e3b.js";import{C as re}from"./CloudUploadOutlined-bc652310.js";/* empty css                                                     */const le={class:"tab-description"},ie={class:"editor-container"},ce={class:"editor-container"},ye={__name:"ToolEditView",setup(ue){const L=G(),T=Q(),c=y(()=>T.params.id),d=y(()=>!!c.value),u=i(!1),w=i(!1),v=i(!1),_=i(!1),M=i("parameters"),a=X({name:"",description:"",parametersStr:JSON.stringify({type:"object",properties:{name:{type:"string",description:"名称"}},required:["name"]},null,2),code:`# parameters: 传入参数
# config: 传入配置
# result: 用于返回值

# 示例代码：
print("执行工具...")
result = {"message": "Hello, World!", "parameters": parameters, "config": config}
`,func_ids:[],config_ids:[]}),O=i([]),k=i([]);y(()=>{try{const e=JSON.parse(a.parametersStr);return JSON.stringify(e,null,2)}catch{return"无效的 JSON"}}),Y(async()=>{await Promise.all([B(),$()]),d.value&&await V()});const B=async()=>{v.value=!0;try{await l({method:"get",url:"/api/v1/func",params:{page:1,size:100},onSuccess:e=>{O.value=e.map(t=>({value:t.id,label:t.name}))},errorMessage:"获取函数列表失败"})}finally{v.value=!1}},$=async()=>{_.value=!0;try{await l({method:"get",url:"/api/v1/config",params:{page:1,size:100},onSuccess:e=>{k.value=e.map(t=>({value:t.id,label:t.name}))},errorMessage:"获取配置列表失败"})}finally{_.value=!1}},V=async()=>{w.value=!0;try{await l({method:"get",url:`/api/v1/tool/${c.value}`,onSuccess:e=>{a.name=e.name,a.description=e.description||"",a.parametersStr=JSON.stringify(e.parameters,null,2),a.code=e.code,q(),D()},errorMessage:"获取工具数据失败"})}finally{w.value=!1}},q=async()=>{try{await l({method:"get",url:`/api/v1/tool/${c.value}/func`,onSuccess:e=>{e&&Array.isArray(e)?a.func_ids=e.map(t=>t.id):a.func_ids=[]},errorMessage:"获取工具依赖函数失败"})}catch(e){console.error("Error fetching tool dependent functions:",e)}},D=async()=>{try{await l({method:"get",url:`/api/v1/tool/${c.value}/config`,onSuccess:e=>{e&&Array.isArray(e)?a.config_ids=e.map(t=>t.id):a.config_ids=[]},errorMessage:"获取工具绑定配置失败"})}catch(e){console.error("Error fetching tool bound configs:",e)}},C=()=>{if(!a.name)return m.error("请输入工具名称"),!1;if(!a.description)return m.error("请输入工具描述"),!1;const e=te(a.parametersStr);return e.valid?a.code?!0:(m.error("请输入工具代码"),!1):(m.error("参数定义 JSON 格式不正确: "+e.message),!1)},N=()=>({name:a.name,description:a.description,parameters:JSON.parse(a.parametersStr),code:a.code,func_ids:a.func_ids,config_ids:a.config_ids}),E=async()=>{if(C()){u.value=!0;try{const e=N();d.value?await l({method:"put",url:`/api/v1/tool/${c.value}`,data:e,successMessage:"保存成功",errorMessage:"保存失败",onSuccess:()=>{p()}}):await l({method:"post",url:"/api/v1/tool",data:e,successMessage:"创建成功",errorMessage:"创建失败",onSuccess:()=>{p()}})}finally{u.value=!1}}},F=async()=>{if(C()){u.value=!0;try{const e=N();d.value?await l({method:"put",url:`/api/v1/tool/${c.value}/deploy`,data:e,successMessage:"保存并发布成功",errorMessage:"保存并发布失败",onSuccess:()=>{p()}}):await l({method:"post",url:"/api/v1/tool/deploy",data:e,successMessage:"创建并发布成功",errorMessage:"创建并发布失败",onSuccess:()=>{p()}})}finally{u.value=!1}}},p=()=>{L.back()};return(e,t)=>{const g=r("a-button"),K=r("a-space"),R=r("a-input"),f=r("a-form-item"),j=r("a-textarea"),J=r("a-select"),A=r("a-col"),z=r("a-row"),P=r("a-alert"),U=r("a-tab-pane"),H=r("a-tabs"),I=r("a-form"),W=r("a-card");return Z(),ee(oe,{"current-page-key":"tool"},{default:s(()=>[o(W,{title:d.value?"编辑工具":"创建工具"},{extra:s(()=>[o(K,null,{default:s(()=>[o(g,{onClick:p},{icon:s(()=>[o(S(se))]),default:s(()=>[b(" 返回 ")]),_:1}),o(g,{type:"primary",loading:u.value,onClick:E},{icon:s(()=>[o(S(ne))]),default:s(()=>[b(" 保存 ")]),_:1},8,["loading"]),o(g,{type:"primary",loading:u.value,onClick:F},{icon:s(()=>[o(S(re))]),default:s(()=>[b(" "+ae(d.value?"保存并发布":"创建并发布"),1)]),_:1},8,["loading"])]),_:1})]),default:s(()=>[o(I,{model:a,layout:"vertical",class:"form-container"},{default:s(()=>[o(f,{label:"工具名称",required:""},{default:s(()=>[o(R,{value:a.name,"onUpdate:value":t[0]||(t[0]=n=>a.name=n),placeholder:"请输入工具名称"},null,8,["value"])]),_:1}),o(f,{label:"工具描述",required:""},{default:s(()=>[o(j,{value:a.description,"onUpdate:value":t[1]||(t[1]=n=>a.description=n),placeholder:"请输入工具描述",rows:3},null,8,["value"])]),_:1}),o(z,{gutter:16},{default:s(()=>[o(A,{span:12},{default:s(()=>[o(f,{label:"依赖函数"},{default:s(()=>[o(J,{value:a.func_ids,"onUpdate:value":t[2]||(t[2]=n=>a.func_ids=n),mode:"multiple",placeholder:"请选择依赖函数",loading:v.value,options:O.value},null,8,["value","loading","options"])]),_:1})]),_:1}),o(A,{span:12},{default:s(()=>[o(f,{label:"绑定配置"},{default:s(()=>[o(J,{value:a.config_ids,"onUpdate:value":t[3]||(t[3]=n=>a.config_ids=n),mode:"multiple",placeholder:"请选择绑定配置",loading:_.value,options:k.value},null,8,["value","loading","options"])]),_:1})]),_:1})]),_:1}),o(f,null,{default:s(()=>[o(H,{activeKey:M.value,"onUpdate:activeKey":t[6]||(t[6]=n=>M.value=n)},{default:s(()=>[o(U,{key:"parameters",tab:"参数定义","force-render":""},{default:s(()=>[h("div",le,[o(P,{message:"参数定义说明",description:"使用JSON Schema格式定义工具的输入参数。定义每个参数的类型和描述，系统将此定义作为MCP Tool的参数定义。",type:"info","show-icon":""})]),h("div",ie,[o(x,{value:a.parametersStr,"onUpdate:value":t[4]||(t[4]=n=>a.parametersStr=n),language:"json",options:{automaticLayout:!0,scrollBeyondLastLine:!1}},null,8,["value"])])]),_:1}),o(U,{key:"code",tab:"工具代码","force-render":""},{default:s(()=>[h("div",ce,[o(x,{value:a.code,"onUpdate:value":t[5]||(t[5]=n=>a.code=n),language:"python",options:{automaticLayout:!0,scrollBeyondLastLine:!1}},null,8,["value"])])]),_:1})]),_:1},8,["activeKey"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})}}};export{ye as default};
