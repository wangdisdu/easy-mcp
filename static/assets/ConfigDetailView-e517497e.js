import{_ as Y,u as Z,n as ee,q as b,r as k,o as te,b as _,c as s,d as p,w as a,e as i,f as v,g as m,l as oe,h as o,t as r,j as u,F as E,s as j,k as g,p as se,i as ae}from"./index-53057e88.js";import{c as R,A as ne,f as I,T as ce}from"./AppLayout-7b7aaf0d.js";import{R as ie}from"./RollbackOutlined-c89baf36.js";import{Q as re}from"./QuestionCircleOutlined-96d10665.js";const f=y=>(se("data-v-2e1d6542"),y=y(),ae(),y),le={class:"info-container"},ue={class:"info-row"},_e=f(()=>o("div",{class:"info-label"},"配置名称:",-1)),de={class:"info-value"},fe={class:"info-row"},ve=f(()=>o("div",{class:"info-label"},"配置描述:",-1)),pe={class:"info-value"},me={class:"info-row"},he=f(()=>o("div",{class:"info-label"},"创建时间:",-1)),ge={class:"info-value"},ye={class:"info-row"},be=f(()=>o("div",{class:"info-label"},"更新时间:",-1)),ke={class:"info-value"},we={class:"info-row"},Ce=f(()=>o("div",{class:"info-label"},"创建人:",-1)),Se={class:"info-value"},Oe={class:"info-row"},Ve=f(()=>o("div",{class:"info-label"},"更新人:",-1)),Ne={class:"info-value"},xe={key:0,class:"empty-message"},Te={key:1},$e={key:1,class:"empty-message"},De={key:2},Ee={class:"config-item-row"},je={class:"config-item-label"},Re=f(()=>o("strong",null,"类型：",-1)),Ie={key:0},Je=f(()=>o("strong",null,"描述：",-1)),Pe={key:1},qe=f(()=>o("strong",null,"必填：",-1)),Ae={key:2},Be=f(()=>o("strong",null,"默认值：",-1)),Ke={class:"config-item-value"},Le={key:0},Me={key:1},Fe=["onClick"],Qe={class:"tool-description"},Ue={__name:"ConfigDetailView",setup(y){const w=Z(),J=ee(),C=b(()=>J.params.id),x=k(!1),e=k(null),S=k([]),T=k("basic"),h=b(()=>{if(!e.value||!e.value.conf_schema)return!1;try{const t=e.value.conf_schema;return t&&t.type==="object"&&t.properties}catch(t){return console.error("Error validating schema:",t),!1}}),O=b(()=>{if(!e.value||!e.value.conf_value)return{};try{return typeof e.value.conf_value=="string"?JSON.parse(e.value.conf_value):e.value.conf_value}catch(t){return console.error("Error parsing configuration value:",t),{}}}),P=b(()=>O.value&&Object.keys(O.value).length>0),q=t=>{if(!h.value||!e.value||!e.value.conf_schema||!e.value.conf_schema.properties)return t;const c=e.value.conf_schema.properties[t];return c&&c.title||t},A=t=>{if(!h.value||!e.value||!e.value.conf_schema||!e.value.conf_schema.properties)return"unknown";const c=e.value.conf_schema.properties[t];return c?c.type||"unknown":"object"},$=t=>{if(!h.value||!e.value||!e.value.conf_schema||!e.value.conf_schema.properties)return"";const c=e.value.conf_schema.properties[t];return c&&c.description||""},B=t=>{if(!h.value||!e.value||!e.value.conf_schema||!e.value.conf_schema.properties)return!1;const n=e.value.conf_schema;return n.properties[t]?n.required&&n.required.includes(t):!1},D=t=>{if(!h.value||!e.value||!e.value.conf_schema||!e.value.conf_schema.properties)return;const c=e.value.conf_schema.properties[t];if(c)return c.default},K=t=>typeof t=="object"&&t!==null;te(()=>{L(),M()});const L=async()=>{x.value=!0;try{await R({method:"get",url:`/api/v1/config/${C.value}`,onSuccess:t=>{if(t&&t.conf_schema&&typeof t.conf_schema=="string")try{t.conf_schema=JSON.parse(t.conf_schema)}catch(n){console.error("Error parsing conf_schema:",n),t.conf_schema={}}e.value=t},errorMessage:"获取配置数据失败"})}catch(t){console.error("Error fetching config data:",t)}finally{x.value=!1}},M=async()=>{try{await R({method:"get",url:`/api/v1/config/${C.value}/usage`,onSuccess:t=>{S.value=t.tools||[]},errorMessage:"获取关联工具失败"})}catch(t){console.error("Error fetching related tools:",t)}};return(t,n)=>{const c=_("a-button"),F=_("a-space"),V=_("a-tab-pane"),N=_("a-empty"),Q=_("a-alert"),U=_("a-tooltip"),z=_("a-list-item-meta"),G=_("a-list-item"),H=_("a-list"),W=_("a-tabs"),X=_("a-card");return s(),p(ne,{"current-page-key":"config"},{default:a(()=>[e.value?(s(),p(X,{key:0,title:`配置详情 - ${e.value?e.value.name:""}`},{extra:a(()=>[i(F,null,{default:a(()=>[i(c,{onClick:n[0]||(n[0]=l=>v(w).push("/config"))},{icon:a(()=>[i(v(ie))]),default:a(()=>[m(" 返回 ")]),_:1}),i(c,{type:"primary",onClick:n[1]||(n[1]=l=>v(w).push(`/config/${C.value}/edit`))},{icon:a(()=>[i(v(oe))]),default:a(()=>[m(" 编辑 ")]),_:1})]),_:1})]),default:a(()=>[i(W,{activeKey:T.value,"onUpdate:activeKey":n[2]||(n[2]=l=>T.value=l)},{default:a(()=>[i(V,{key:"basic",tab:"基本信息"},{default:a(()=>[o("div",le,[o("div",ue,[_e,o("div",de,r(e.value.name),1)]),o("div",fe,[ve,o("div",pe,r(e.value.description||"无描述"),1)]),o("div",me,[he,o("div",ge,r(v(I)(e.value.created_at)),1)]),o("div",ye,[be,o("div",ke,r(v(I)(e.value.updated_at)),1)]),o("div",we,[Ce,o("div",Se,r(e.value.created_by||"-"),1)]),o("div",Oe,[Ve,o("div",Ne,r(e.value.updated_by||"-"),1)])])]),_:1}),i(V,{key:"config",tab:"配置信息"},{default:a(()=>[e.value.conf_schema?(s(),u("div",Te,[h.value?P.value?(s(),u("div",De,[(s(!0),u(E,null,j(O.value,(l,d)=>(s(),u("div",{key:d,class:"config-item"},[o("div",Ee,[o("div",je,[m(r(q(d))+" ",1),e.value.value&&e.value.value.conf_schema&&e.value.value.conf_schema.properties&&e.value.value.conf_schema.properties[d]?(s(),p(U,{key:0,placement:"right"},{title:a(()=>[o("div",null,[o("div",null,[Re,m(" "+r(A(d)),1)]),$(d)?(s(),u("div",Ie,[Je,m(" "+r($(d)),1)])):g("",!0),B(d)?(s(),u("div",Pe,[qe,m(" 是")])):g("",!0),D(d)!==void 0?(s(),u("div",Ae,[Be,m(" "+r(JSON.stringify(D(d))),1)])):g("",!0)])]),default:a(()=>[i(v(re),{class:"config-item-icon"})]),_:2},1024)):g("",!0)]),o("div",Ke,[K(l)?(s(),u("pre",Le,r(JSON.stringify(l,null,2)),1)):(s(),u("span",Me,r(l),1))])])]))),128))])):(s(),u("div",$e,[i(N,{description:"无配置值"})])):(s(),p(Q,{key:0,type:"warning",message:"配置架构不是有效的JSON Schema格式",banner:"",style:{"margin-bottom":"16px"}}))])):(s(),u("div",xe,[i(N,{description:"无配置架构"})]))]),_:1}),i(V,{key:"tools",tab:"关联工具"},{default:a(()=>[S.value.length?(s(),p(H,{key:1},{default:a(()=>[(s(!0),u(E,null,j(S.value,l=>(s(),p(G,{key:l.id},{default:a(()=>[i(z,null,{avatar:a(()=>[i(v(ce),{class:"tool-icon"})]),title:a(()=>[o("a",{class:"tool-link",onClick:d=>v(w).push(`/tool/${l.id}`)},r(l.name),9,Fe)]),description:a(()=>[o("div",Qe,r(l.description||"无描述"),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(s(),p(N,{key:0,description:"无关联工具"}))]),_:1})]),_:1},8,["activeKey"])]),_:1},8,["title"])):g("",!0)]),_:1})}}},Xe=Y(Ue,[["__scopeId","data-v-2e1d6542"]]);export{Xe as default};
