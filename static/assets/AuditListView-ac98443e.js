import{u as H,r as _,a as K,o as Q,b as i,c as r,d as h,w as e,e as t,h as W,g as s,f as S,G as X,t as f,j as p,F as N,E as Y,k as x}from"./index-53057e88.js";import{c as Z,A as ee,f as te}from"./AppLayout-7b7aaf0d.js";const ae={class:"action-bar"},oe=["onClick"],le={key:1},ne={key:3},se={key:4},ue={key:0},de={__name:"AuditListView",setup(re){const v=H(),w=_(!1),M=_([]),z=_(0),y=_(1),k=_(10),n=K({username:"",action:void 0,resource_type:void 0,resource_name:""}),b=_(!1),C=_(null),T=[{title:"用户名",dataIndex:"username",key:"username",width:120},{title:"操作类型",key:"action",width:100},{title:"资源类型",key:"resource_type",width:100},{title:"资源ID",key:"resource_id",width:80},{title:"资源名称",key:"resource_name",width:150,ellipsis:!0,tooltip:!0},{title:"IP地址",dataIndex:"ip_address",key:"ip_address",width:120},{title:"操作时间",key:"created_at",width:180},{title:"详情",key:"details",width:100}];Q(()=>{g()});const g=async()=>{w.value=!0;try{const a={page:y.value,size:k.value};n.username&&(a.username=n.username),n.action&&(a.action=n.action),n.resource_type&&(a.resource_type=n.resource_type),n.resource_name&&(a.resource_name=n.resource_name),await Z({method:"get",url:"/api/v1/audit",params:a,onSuccess:(o,c)=>{M.value=o,z.value=c.total},errorMessage:"获取审计日志失败"})}finally{w.value=!1}},U=()=>{y.value=1,g()},B=(a,o)=>{y.value=a,k.value=o,g()},I=(a,o)=>{y.value=1,k.value=o,g()},O=a=>({create:"创建",update:"更新",delete:"删除",deploy:"发布",rollback:"回滚"})[a]||a,P=a=>({create:"green",update:"blue",delete:"red",deploy:"purple",rollback:"orange"})[a]||"default",R=a=>({user:"用户",tool:"工具",func:"函数",config:"配置"})[a]||a,D=a=>({user:"cyan",tool:"blue",func:"green",config:"purple"})[a]||"default",E=a=>{const{resource_type:o,resource_id:c}=a;if(c)switch(o){case"user":v.push(`/user/${c}/edit`);break;case"tool":v.push(`/tool/${c}`);break;case"func":v.push(`/func/${c}`);break;case"config":v.push(`/config/${c}`);break}},F=a=>{C.value=a,b.value=!0};return(a,o)=>{const c=i("a-input"),m=i("a-form-item"),d=i("a-select-option"),A=i("a-select"),$=i("a-button"),L=i("a-form"),V=i("a-tag"),j=i("a-table"),G=i("a-modal"),J=i("a-card");return r(),h(ee,{"current-page-key":"audit"},{default:e(()=>[t(J,{title:"审计日志"},{default:e(()=>[W("div",ae,[t(L,{layout:"inline"},{default:e(()=>[t(m,{label:"用户名"},{default:e(()=>[t(c,{value:n.username,"onUpdate:value":o[0]||(o[0]=l=>n.username=l),placeholder:"用户名"},null,8,["value"])]),_:1}),t(m,{label:"操作类型"},{default:e(()=>[t(A,{value:n.action,"onUpdate:value":o[1]||(o[1]=l=>n.action=l),style:{width:"120px"},placeholder:"操作类型","allow-clear":""},{default:e(()=>[t(d,{value:"create"},{default:e(()=>[s("创建")]),_:1}),t(d,{value:"update"},{default:e(()=>[s("更新")]),_:1}),t(d,{value:"delete"},{default:e(()=>[s("删除")]),_:1}),t(d,{value:"deploy"},{default:e(()=>[s("发布")]),_:1}),t(d,{value:"rollback"},{default:e(()=>[s("回滚")]),_:1})]),_:1},8,["value"])]),_:1}),t(m,{label:"资源类型"},{default:e(()=>[t(A,{value:n.resource_type,"onUpdate:value":o[2]||(o[2]=l=>n.resource_type=l),style:{width:"120px"},placeholder:"资源类型","allow-clear":""},{default:e(()=>[t(d,{value:"user"},{default:e(()=>[s("用户")]),_:1}),t(d,{value:"tool"},{default:e(()=>[s("工具")]),_:1}),t(d,{value:"func"},{default:e(()=>[s("函数")]),_:1}),t(d,{value:"config"},{default:e(()=>[s("配置")]),_:1})]),_:1},8,["value"])]),_:1}),t(m,{label:"资源名称"},{default:e(()=>[t(c,{value:n.resource_name,"onUpdate:value":o[3]||(o[3]=l=>n.resource_name=l),placeholder:"资源名称"},null,8,["value"])]),_:1}),t(m,null,{default:e(()=>[t($,{type:"primary",onClick:U},{icon:e(()=>[t(S(X))]),default:e(()=>[s(" 搜索 ")]),_:1})]),_:1})]),_:1})]),t(j,{columns:T,"data-source":M.value,loading:w.value,pagination:{current:y.value,pageSize:k.value,total:z.value,onChange:B,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onShowSizeChange:I,showTotal:l=>`共 ${l} 条记录`},"row-key":l=>l.id},{bodyCell:e(({column:l,record:u})=>[l.key==="action"?(r(),h(V,{key:0,color:P(u.action)},{default:e(()=>[s(f(O(u.action)),1)]),_:2},1032,["color"])):l.key==="resource_type"?(r(),h(V,{key:1,color:D(u.resource_type)},{default:e(()=>[s(f(R(u.resource_type)),1)]),_:2},1032,["color"])):l.key==="resource_id"?(r(),p(N,{key:2},[u.resource_id?(r(),p("a",{key:0,onClick:q=>E(u)},f(u.resource_id),9,oe)):(r(),p("span",le,"-"))],64)):l.key==="resource_name"?(r(),p("span",ne,f(u.resource_name||"-"),1)):l.key==="created_at"?(r(),p("span",se,f(S(te)(u.created_at)),1)):l.key==="details"?(r(),p(N,{key:5},[u.details?(r(),h($,{key:0,type:"link",size:"small",onClick:q=>F(u)},{icon:e(()=>[t(S(Y))]),default:e(()=>[s(" 查看详情 ")]),_:2},1032,["onClick"])):x("",!0)],64)):x("",!0)]),_:1},8,["data-source","loading","pagination","row-key"]),t(G,{open:b.value,"onUpdate:open":o[4]||(o[4]=l=>b.value=l),title:"操作详情",width:"800px",footer:null},{default:e(()=>[C.value?(r(),p("pre",ue,f(JSON.stringify(C.value.details,null,2)),1)):x("",!0)]),_:1},8,["open"])]),_:1})]),_:1})}}};export{de as default};
